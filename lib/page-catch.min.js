!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["page-catch"]=t():e["page-catch"]=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n,o,u,l,i,s,c,a,f,d,h,m,p,g,b,v,y,A,x,E,S,T,L=function(e,t){function r(){this.constructor=e}for(var n in t)k.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},k={}.hasOwnProperty,w=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};T=r(1),i=r(2),E=r(3),S=r(4),l=["dns-prefetch","canonical","publisher","prefetch"," alternate","bb:rum"],n=["Content-Security-Policy","refresh"],o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return L(t,e),t}(Error),x=function(){var e,t,r,n,o,u,l,i,s,c;/*!
	   * get frame index in page
	   * @return {String} - frame index
	   * @example 0:3:5
	   */
/*!
	   * get frame position on content script
	   * @param {HTMLDocument} DOM - DOM document object
	   * @return {Object} - frames position on current frame
	   * @example [3,0,0]: 0
	   */
/*!
	   * get page doctype with all atributes'
	   * @param {DocumentType} doctype - document doctype object
	   * @return {array} - array with attributes of doctype page
	   * @return null - if doctype is absent
	   * @example ["html","w3c",""]
	   */
/*!
	   * get attributes of tag <html ...>...</html>
	   * @param {array} array - array with html attributes
	   * @return {array} - array with attributes of tag <html>
	   * @example ["lang","en","class","is-copy-enable"]
	   */
return i={},c=[],e=function(e){var t,r,n,o,u,l,i;for(i=[];e&&"HTML"!==e.nodeName;){if(u=e.parentElement)for(l=u.children,r=n=0,o=l.length;n<o;r=++n)if(t=l[r],u.children[r]===e){i.unshift(r);break}e=u}return i=i.join(":")},r=function(t){var r,n,o,u,l,i,s,a,f;for(i=[],r=0,o=t.length;r<o;r++)if(f=t[r],a="",f.rules){for(l=f.rules,n=0,u=l.length;n<u;n++)s=l[n],a+=s.cssText;i.push(c.push([a,e(f.ownerNode)]))}else i.push(void 0);return i},r(document.styleSheets),l=function(e){var t,r,n,o,u,l,s;for(l=[],n=0,u=e.length;n<u;n++)t=e[n],s=e[t].indexOf("url("),l.push(function(){var n;for(n=[];s>-1;)r=e[t].indexOf(")",s+1),o=e[t].substring(s+4,r),(o.startsWith('"')||o.startsWith("'"))&&(o=o.substring(1,o.length-1)),o.startsWith("#")||(i[o]=!0),n.push(s=e[t].indexOf("url(",r+1));return n}());return l},s=function(e){var t,r,n,o;for(r=e.children,n=0,o=r.length;n<o;n++)t=r[n],s(t);return l(window.getComputedStyle(e)),l(window.getComputedStyle(e,":after")),l(window.getComputedStyle(e,":before"))},s(document.body),u=function(){var e,t;/*!
	     * add frame-ID into fid[] array (recursive)
	     * @param {Window} win - parent's Window object
	     */
return t=[],e=function(r){var n,o,u,l,i,s,c;if(s=r.parent,r!==s){for(u="?",c=s.frames,o=l=0,i=c.length;l<i;o=++l)if(n=c[o],r===n){u=o;break}t.unshift(u),e(s)}},e(window),t.join(":")},o=function(e){var t,r,n,o,u,l,i,s;for(t={},/*!
	     * get frameID
	     * @param {HTMLIframeElement} obj - iframe document object
	     * @return {String} - string with index iframe
	     * @example [3,0,0]
	     */
n=function(t){var r,n;return n=[],r=function(t){var o,u,l;if(t.parentElement!==e)return l=t.parentElement,u=Array.prototype.slice.call(l.children),o=u.indexOf(t),n.unshift(o),r(l)},r(t),JSON.stringify(n)},r=e.getElementsByTagName("iframe"),l=0,i=r.length;l<i;l++)for(u=r[l],o=0;o<window.frames.length;){if(u.contentWindow===window.frames[o]){t[n(u,e)]=o,s=[];break}o++}return t},n=function(e){return null!=e?[e.name,e.publicId,e.systemId]:null},t=function(e){var t,r,n,o;for(o=[],r=0,n=e.length;r<n;r++)t=e[r],o.push(t.nodeName,t.nodeValue);return o},[[document.URL,document.location.protocol],[document.head.innerHTML,document.body.outerHTML],t(document.documentElement.attributes),u(),o(document.documentElement),n(document.doctype),i,c]},h=function(e){var t,r,n,o;for(t=e.querySelectorAll("iframe"),r=n=0,o=t.length;0<=o?n<o:n>o;r=0<=o?++n:--n)t[r].parentElement.removeChild(t[r]),r--;return e},/*!
	 * convert html text of every frame to DOM-Tree
	 * @param {string} head - string with html code of head
	 * @param {string} body - string with html code of body
	 * @return {HTMLDocument} - created DOM with string
	 */
v=function(e,t){var r;return r=document.implementation.createHTMLDocument(),r.head.innerHTML=e,r.body.outerHTML=t,r.getElementsByTagName("head")[1].parentElement.removeChild(r.getElementsByTagName("head")[1]),r},/*!
	 * get frame position on background script
	 * @param {HTMLIframeElement} - iframe that we want find position,
	 * @param {HTMLDocument} - DOM that are parent of this iframe,
	 * @return {String} - string with iframe position
	 * @example [3,0,0]
	 */
y=function(e,t){var r,n;return n=[],r=function(e){var o,u,l;if(e.parentElement!==t.documentElement)return l=e.parentElement,u=Array.prototype.slice.call(l.children),o=u.indexOf(e),n.unshift(o),r(l)},r(e),JSON.stringify(n)},/*!
	 * delete iframe security policy
	 * @param {HTMLDocument} - DOM object
	 */
m=function(e){var t;return t=e.querySelectorAll("meta[http-equiv]"),t.forEach(function(e){var t,r;if(t=e.getAttribute("http-equiv"),w.call(n,t)>=0)return null!=(r=e.parentElement)?r.removeChild(e):void 0})},/*!
	 * delete iframe security policy
	 * @param {HTMLDocument} - DOM object
	 */
p=function(e){var t;return t=e.querySelectorAll("iframe[sendbox]"),t.forEach(function(e){return e.removeAttribute("sendbox")})},/*!
	 * add meta tag informing that this page is saved by PageCatch
	 * @param {HTMLDocument} - DOM of current document,
	 * @param {String} - string with url of current iframe,
	 * NOTE: if original-url meta alread exists (with original site url), do
	 * not create a new one. It means, that we resave already stored page
	 */
u=function(e,t){var r,n,o;if(!e.querySelector('meta[name="original-url"]'))return n=document.createElement("meta"),n.setAttribute("name","original-url"),n.setAttribute("content",t),r=null!=(o=e.getElementsByTagName("head")[0])?o:e.getElementsByTagName("body")[0],r.insertBefore(n,r.children[0])},c=function(e){return(e.indexOf("&amp;")>=0||e.indexOf("&quot;")>=0||e.indexOf("&gt;")>=0||e.indexOf("&lt;")>=0)&&(e=e.replace(/\&amp\;/g,"&"),e=e.replace(/\&quot\;/g,'"'),e=e.replace(/\&lt\;/g,"<"),e=e.replace(/\&gt\;/g,">"),e=c(e),c(e)),e},a=function(e){var t,r,n,o;for(n=e.getElementsByTagName("noscript"),t=0,r=n.length;t<r;t++)o=n[t],o.outerHTML=c(o.outerHTML);return e},/*!
	 * run functions for delete security policy
	 * @param {HTMLDocument} - DOM of current document
	 * @param {String} - string with url of current iframe
	 */
f=function(e,t){return a(e),m(e),p(e),u(e,t)},/*!
	 * take html attributes for save
	 * @param {array} array - array with attributes of tag <html>...</html>,
	 * @param {DocumentElement} status - Doctype of document,
	 * @return {String} - string with html code with all atributes + doctype
	 * @example "<! DOCTYPE html> <html lang="en" class="is-absent"><head>...</html>"
	 */
g=function(e,t){var r,n,o,u,l;for(l="<html ",n=o=0,u=e.length;o<u&&null!=e[n+1];n=o+=2)l+=e[n]+'="'+e[n+1]+'" ';return null!=t?(r=b(t),r+l+">"):l+=">"},/*!
	 * take doctype with attributes for save
	 * @param {array} array - array with attributes of doctype,
	 * @return {String} - string with doctype of page
	 * @example "<!DOCTYPE html>"
	 */
b=function(e){var t,r,n,o,u;for(u="<!DOCTYPE ",t="",r=n=0,o=e.length;0<=o?n<o:n>o;r=0<=o?++n:--n)if(e[r].trim())switch(r){case 0:u+=e[r]+" ";break;case 1:u+='PUBLIC "'+e[r]+'" ';break;case 2:u+='"'+e[r]+'"'}return u+">"},d=function(e){var t,r,n,o;for(r=e.querySelectorAll("div,img"),n=0,o=r.length;n<o;n++)t=r[n],t.parentElement.removeChild(t);return document},s=function(e){var t,r,n,o,u,l,i;for(i=[];e&&"HTML"!==e.nodeName;){if(u=e.parentElement)for(l=u.children,r=n=0,o=l.length;n<o;r=++n)if(t=l[r],u.children[r]===e){i.unshift(r);break}e=u}return i=i.join(":")},/*!
	 * save page
	 * @param {Number} tabID - number of tab which you want to save,
	 * @param {Function} cleanUp - function with clean any attributes from page,
	 * @param {Function} done - function in which will be return html text of
	 *                          saved page
	 * @example "<! DOCTYPE html> <html lang="en" class="is-absent"><head>...</html>"
	 */
A=function(e,t,r){var n,o,u,c,a,h;/*!
	   * parse tags as img,style,link and parse attribute style in any tags with him
	   * @param {Function} callback - function that check completing of save
	   */
/*!
	   * create one object from dictionary of frames
	   * @param {Object} obj - obj of dictionary(any frame from page)
	   * @param {String} str - string with current index in recursive
	   */
/*!
	   * finish and return string with complete all resourses in one HTML
	   * @param {Number} counter - counter of tags
	   * @param {Number} counter1 - counter of attributes
	   */
return o={},c=!1,a=function(e){var t,r,n,u,a,f,h,m,p,g,b,v,y,A,x,L,k,O,B,N,H,M,C,q,U,j,I,_,R,W,D,P,X,G,J,F,Y,K,V,$,z,Q;for(C=null!=(j=o[""])?j.document.querySelectorAll("[name]"):void 0,p=0,y=C.length;p<y;p++)if(M=C[p],"original-url"===M.getAttribute("name"))return c=!0,void e(0,0,0);for(a=[],N=null!=(I=o[""])?I.document.querySelectorAll("link"):void 0,m=!1,h=0,g=0,A=N.length;g<A;g++)B=N[g],P=B.getAttribute("rel"),null!==P&&P.indexOf("icon")!==-1&&("icon"===P&&(m=!0),a.push(B));m||(z=null!=(_=o[""])?_.url[0]:void 0,Q=z.split("/"),Q=Q.slice(0,3),z=Q.join("/")+"/favicon.ico",B=document.createElement("link"),B.setAttribute("rel","icon"),h=1,T(z,B,function(t,n,u){var l;return null!=t?(h--,console.error("(src)Base 64 error:",t.stack)):(""===u?(h++,0!==a.length?l=a[0].getAttribute("href"):h--,e(K,r,h),T(l,n,function(t,n,u){return null!=t?(h--,console.error("(src)Base 64 error:",t.stack)):(n.setAttribute("href",u),o[""].document.head.appendChild(n),h--),e(K,r,h)})):(n.setAttribute("href",u),o[""].document.head.appendChild(n),h--),e(K,r,h))})),r=0,K=0;for(b in o){for(u=o[b],u.document.head=d(u.document.head),F=u.document.querySelectorAll("style"),v=0,x=F.length;v<x;v++)if(J=F[v],0===J.innerHTML.length)for(X=s(J),R=u.styleSheets,H=0,L=R.length;H<L;H++)if(t=R[H],t[1]===X){J.innerHTML=t[0];break}for($=u.document.querySelectorAll("*[style]"),q=0,k=$.length;q<k;q++)Y=$[q],r++,S(Y.getAttribute("style"),Y,u.url[0],u,[],function(t,n,o,u){return r--,null!=t?console.error("Style attr error",t):n.setAttribute("style",u),e(K,r,h)});for(V=u.document.querySelectorAll("img,link,source,style, object"),U=0,O=V.length;U<O;U++)if(Y=V[U],K++,"LINK"!==Y.nodeName)if("IMG"!==Y.nodeName)if("OBJECT"!==Y.nodeName)if("STYLE"!==Y.nodeName)if("SOURCE"!==Y.nodeName)K--;else{if(Y.type.indexOf("video")>-1||Y.type.indexOf("audio")>-1){K--;continue}if(Y.hasAttribute("srcset")&&!Y.hasAttribute("src")){G=i(Y.getAttribute("srcset"),u.url[0],u.url[1]),T(G,Y,function(t,n,o){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("srcset",o),e(K,r,h)});continue}if(Y.hasAttribute("src")&&!Y.hasAttribute("srcset")){G=i(Y.getAttribute("src"),u.url[0],u.url[1]),T(G,Y,function(t,n,o){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("src",o),e(K,r,h)});continue}if(Y.hasAttribute("src")&&Y.hasAttribute("srcset")){Y.setAttribute("srcset",""),G=i(Y.getAttribute("src"),u.url[0],u.url[1]),T(G,Y,function(t,n,o){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("src",o),e(K,r,h)});continue}K--}else S(Y.innerHTML,Y,u.url[0],u,[],function(t,n,o,u){return K--,null!=t?console.error("(style)inlineCSS error:",t.stack):n.innerHTML=u,e(K,r,h)});else{if(Y.hasAttribute("data")){G=i(Y.getAttribute("data"),u.url[0],u.url[1]),T(G,Y,function(t,n,o){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("srcset",o),e(K,r,h)});continue}K--}else{if(Y.hasAttribute("srcset")&&!Y.hasAttribute("src")){G=i(Y.getAttribute("srcset"),u.url[0],u.url[1]),T(G,Y,function(t,n,o){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("srcset",o),e(K,r,h)});continue}if(Y.hasAttribute("src")&&!Y.hasAttribute("srcset")){G=i(Y.getAttribute("src"),u.url[0],u.url[1]),T(G,Y,function(t,n,o){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("src",o),e(K,r,h)});continue}if(Y.hasAttribute("src")&&Y.hasAttribute("srcset")){Y.setAttribute("srcset",""),G=i(Y.getAttribute("src"),u.url[0],u.url[1]),T(G,Y,function(t,n,o){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("src",o),e(K,r,h)});continue}K--}else{if("stylesheet"===(W=Y.getAttribute("rel"))||"prefetch stylesheet"===W){f=i(Y.getAttribute("href"),u.url[0],u.url[1]),n=Y.attributes,S(E(f),Y,f,u,n,function(t,n,o,u,l){var i,s,c,a;if(K--,null!=t)console.error("style error",t);else{for(console.log("INLINECSSS_END",n),J=document.createElement("style"),J.innerHTML=u,c=0,s=l.length;c<s;c++)i=l[c],J.setAttribute(i.name,i.value);a=n.parentElement,a.insertBefore(J,n),a.removeChild(n)}return e(K,r,h)});continue}if(D=Y.getAttribute("rel"),w.call(l,D)>=0){Y.parentElement.removeChild(Y),K--;continue}f=i(Y.getAttribute("href"),u.url[0],u.url[1]),T(f,Y,function(t,n,o){return K--,null!=t?console.error("(href) xhrToBase64 error (href="+f+"):",t.stack):n.setAttribute("href",o),e(K,r,h)})}}return c=!0,e(K,r,h)},n=function(e,r){var u,l,i,s,c,a,d,h,m,p,b;for(s=e.document.getElementsByTagName("iframe"),m=[],a=0,h=s.length;a<h;a++){i=s[a],p=y(i,e.document),c=-1;for(d in e.framesIdx)p===d&&(c=e.framesIdx[d]);c!==-1&&(d=r+c,null!=o[d]?(n(o[d],d+":"),l=o[d].url,u=o[d].document,f(u,l[0]),"function"==typeof t&&t(u,l[0]),b=g(o[d].header,o[d].doctype)+u.documentElement.innerHTML+"</html>",m.push(i.setAttribute("srcdoc",b))):m.push(void 0))}return m},h=function(){var e,t;if(e=document.querySelector('meta[name="original-url"]'),t=e.content.split("#"),t[1])return window.location.hash=t[1]},u=function(e,u,l){var i,s,a,d;if(console.log(e,u,l,c),0===e&&0===u&&0===l&&c===!0)return n(o[""],""),s=o[""].url,i=o[""].document,f(i,s[0]),"function"==typeof t&&t(i,s),d=document.createElement("script"),d.innerHTML="("+h.toString()+")()",i.body.appendChild(d),a=g(o[""].header,o[""].doctype)+i.documentElement.innerHTML+"</html>","function"==typeof r&&r(a),o={},c=!1},chrome.tabs.executeScript(e,{code:"("+x.toString()+")()",allFrames:!0,matchAboutBlank:!0},function(e){var t,r,n,l;for(r=0,n=e.length;r<n;r++)t=e[r],l={url:t[0],header:t[2],document:v(t[1][0],t[1][1]),framesIdx:t[4],doctype:t[5],actualUrls:t[6],styleSheets:t[7]},o[t[3]]=l;return a(u)})},e.exports=A},function(e,t){var r;r=function(e,t,r){var n,o;return e.indexOf("data:")>=0||e.length<10?r(null,t,e):(o=new XMLHttpRequest,o.open("GET",e,!0),o.responseType="blob",n=new FileReader,o.onload=function(o){var u;return 200!==this.status?r(null,t," ",e):(u=this.response,n.onloadend=function(){return r(null,t,n.result,e)},n.readAsDataURL(u))},o.onerror=function(n){return console.error("XHR Error "+n.target.status+" occurred while receiving the document."),r(n,t," ",e)},o.send())},e.exports=r},function(e,t){var r=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};e.exports=function(e,t,n){var o,u,l,i,s,c;if(o=!1,('"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1])&&(e=e.substr(1,e.length-2)),e.startsWith("data:"))return e;if(e=e.replace(/\s/g,""),t=t.split("#")[0],e.startsWith("//"))return n+e;if(e.match(/^[\w\-_\d]+:/))return e;if("/"===e[0]&&"/"!==e[1])return o=!0,c=t.split("/"),c=c.slice(0,3),t=c.join("/"),t+e;for(c=t.split("/"),r.call(c[c.length-1],".")>=0&&!o&&c.pop(),""===c[c.length-1]&&c.pop(),i=e.split("/"),u=0,s=i.length;u<s;u++)if(l=i[u],".."===l)c.pop();else{if("."===l)continue;c.push(l)}return c.join("/")}},function(e,t){e.exports=function(e){var t,r;try{return r=new XMLHttpRequest,r.open("GET",e,!1),r.send(),200===r.status?r.responseText:" "}catch(e){return t=e,console.error("XHR",t.stack)," "}}},function(e,t,r){var n,o,u,l,i;u=r(2),o=r(1),i=r(3),l=function(e,t){var r,n,o,u;for(r=0,n=o=0,u=e.length;0<=u?o<u:o>u;n=0<=u?++o:--o)t[e[n]]&&r++;return r},n=function(e,t,r){var n,o,l,i;for(o=/@font-face\s*\{[\s\S]*?src\s*:\s*(?:url\(\s*(['"])?([\s\S]*?)\1\s*\))+[\s\S]*?.*?\}/g,l=/url\(\s*(['"])?([\s\S]*?)\1\s*\)/g;null!=(n=o.exec(e));)for(;null!=(i=l.exec(n[0]));)t[u(i[2],r)]=!0;return t},e.exports=function(e,t,r,s,c,a){var f,d,h,m,p,g,b,v,y,A,x,E;if(m=!1,e.indexOf("@import")>-1&&(y=/@import\s+(?:url\((['"])?([\s\S]*?)\1\)|(['"])?([\s\S]*?)\3)\s*[^;]*?(?:;|$)/gim,e=e.replace(y,function(e){var t;return t=y.exec(e),null==t?"":null!=t[2]?i(u(t[2],r)):null!=t[4]?i(u(t[4],r)):void 0})),e.indexOf("url(")<0)return a(null,t,s,e,c);for(E=[],h=[],f=[],b=0,x=/([\s\S]*?url\()\s*(['"]?)([\s\S]*?)\2\s*(\))/gim,v=x.exec(e);null!=v;){if(h.push(v[1],v[4]),E.push(u(v[3],r,new URL(r).protocol)),b=x.lastIndex,!(e.indexOf("url(",b+1)>-1)){h.push(e.slice(b)),b=e.length;break}v=x.exec(e)}for(h.push(e.slice(b)),s.actualUrls=n(e,s.actualUrls,r),d=l(E,s.actualUrls),p=g=0,A=E.length;0<=A?g<A:g>A;p=0<=A?++g:--g)s.actualUrls[E[p]]&&(m=!0,s.actualUrls[E[p]],o(E[p],t,function(r,n,o,u){var l,i;if(d--,null!=r?console.error("Error base64:",r.stack):s.actualUrls[u]=o,0===d){for(e=[],l=0,i=0;l<h.length;)e.push(h[l]),l++,null!=E[i]&&(s.actualUrls[E[i]]||E[i].startsWith("data:")?E[i].startsWith("data:")?e.push('"'+E[i]+'"'):e.push('"'+s.actualUrls[E[i]]+'"'):e.push('""')),null!=h[l]&&e.push(h[l]),l++,i++;return a(null,t,s,e.join(""),c)}}));return m?void 0:a(null,t,s,h.join(""),c)}}])});
//# sourceMappingURL=page-catch.min.js.map