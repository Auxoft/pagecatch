!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["page-catch"]=t():e["page-catch"]=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n,o,u,l,i,s,c,a,f,h,d,m,p,g,b,v,y,A,S,x,E=function(e,t){function r(){this.constructor=e}for(var n in t)T.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},T={}.hasOwnProperty,L=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};x=r(1),i=r(2),A=r(3),S=r(4),l=["dns-prefetch","canonical","publisher","prefetch"," alternate","bb:rum"],n=["Content-Security-Policy","refresh"],o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t}(Error),y=function(){var e,t,r,n,o,u,l,i,s,c;/*!
	   * get frame index in page
	   * @return {String} - frame index
	   * @example 0:3:5
	   */
/*!
	   * get frame position on content script
	   * @param {HTMLDocument} DOM - DOM document object
	   * @return {Object} - frames position on current frame
	   * @example [3,0,0]: 0
	   */
/*!
	   * get page doctype with all atributes'
	   * @param {DocumentType} doctype - document doctype object
	   * @return {array} - array with attributes of doctype page
	   * @return null - if doctype is absent
	   * @example ["html","w3c",""]
	   */
/*!
	   * get attributes of tag <html ...>...</html>
	   * @param {array} array - array with html attributes
	   * @return {array} - array with attributes of tag <html>
	   * @example ["lang","en","class","is-copy-enable"]
	   */
return i={},c=[],e=function(e){var t,r,n,o,u,l,i;for(i=[];e&&"HTML"!==e.nodeName;){if(u=e.parentElement)for(l=u.children,r=n=0,o=l.length;n<o;r=++n)if(t=l[r],u.children[r]===e){i.unshift(r);break}e=u}return i=i.join(":")},r=function(t){var r,n,o,u,l,i,s,a;for(r=0,o=t.length;r<o;r++)if(a=t[r],s="",a.rules){for(l=a.rules,n=0,u=l.length;n<u;n++)i=l[n],s+=i.cssText;c.push([s,e(a.ownerNode)])}return console.log(c)},r(document.styleSheets),l=function(e){var t,r,n,o,u,l,s;for(l=[],n=0,u=e.length;n<u;n++)t=e[n],s=e[t].indexOf("url("),l.push(function(){var n;for(n=[];s>-1;)r=e[t].indexOf(")",s+1),o=e[t].substring(s+4,r),console.log("URL::",o),(o.startsWith('"')||o.startsWith("'"))&&(o=o.substring(1,o.length-1)),o.startsWith("#")||(i[o]=!0,console.assert(i[o]),console.log("ELEM",o)),n.push(s=e[t].indexOf("url(",r+1));return n}());return l},s=function(e){var t,r,n,o;for(r=e.children,n=0,o=r.length;n<o;n++)t=r[n],s(t);return l(window.getComputedStyle(e)),l(window.getComputedStyle(e,":after")),l(window.getComputedStyle(e,":before"))},s(document.body),u=function(){var e,t;/*!
	     * add frame-ID into fid[] array (recursive)
	     * @param {Window} win - parent's Window object
	     */
return t=[],e=function(r){var n,o,u,l,i,s,c;if(s=r.parent,r!==s){for(u="?",c=s.frames,o=l=0,i=c.length;l<i;o=++l)if(n=c[o],r===n){u=o;break}t.unshift(u),e(s)}},e(window),t.join(":")},o=function(e){var t,r,n,o,u,l,i,s;for(t={},/*!
	     * get frameID
	     * @param {HTMLIframeElement} obj - iframe document object
	     * @return {String} - string with index iframe
	     * @example [3,0,0]
	     */
n=function(t){var r,n;return n=[],r=function(t){var o,u,l;if(t.parentElement!==e)return l=t.parentElement,u=Array.prototype.slice.call(l.children),o=u.indexOf(t),n.unshift(o),r(l)},r(t),JSON.stringify(n)},r=e.getElementsByTagName("iframe"),l=0,i=r.length;l<i;l++)for(u=r[l],o=0;o<window.frames.length;){if(u.contentWindow===window.frames[o]){t[n(u,e)]=o,s=[];break}o++}return t},n=function(e){return null!=e?[e.name,e.publicId,e.systemId]:null},t=function(e){var t,r,n,o;for(o=[],r=0,n=e.length;r<n;r++)t=e[r],o.push(t.nodeName,t.nodeValue);return o},[[document.URL,document.location.protocol],document.documentElement.innerHTML,t(document.documentElement.attributes),u(),o(document.documentElement),n(document.doctype),i,c]},f=function(e){var t,r,n,o;for(t=e.querySelectorAll("iframe"),r=n=0,o=t.length;0<=o?n<o:n>o;r=0<=o?++n:--n)t[r].parentElement.removeChild(t[r]),r--;return e},/*!
	 * convert html text of every frame to DOM-Tree
	 * @param {string} htmlText - string with html code
	 * @return {HTMLDocument} - created DOM with string
	 */
g=function(e,t){var r,n,o,u,l,i,s,c,a,h,d,m,p,g,b;if(r=document.implementation.createHTMLDocument(),g=/(?:<!--[\s\S]*?-->|\s)*(<head[\s\S]*?>[\s\S]*?<\/head>)([\s\S]*)$/im,c=/<head(?:[\s\S]*?)>([\s\S]*?)<\/head>/,i=/<body(?:[\s\S]*?)>([\s\S]*?)<\/body>/,a=g.exec(e),s=a[1],l=a[2],b=document.createElement("html"),b.innerHTML=s+l,console.log(b),o=b.getElementsByTagName("body")[0].attributes,u=b.getElementsByTagName("head")[0].attributes,null!=a){for(r.head.innerHTML=c.exec(s)[1],r.head=f(r.head),r.body.innerHTML=i.exec(l)[1],h=0,m=o.length;h<m;h++)n=o[h],r.body.setAttribute(n.name,n.value);for(d=0,p=u.length;d<p;d++)n=u[d],r.head.setAttribute(n.name,n.value)}return r},/*!
	 * get frame position on background script
	 * @param {HTMLIframeElement} - iframe that we want find position,
	 * @param {HTMLDocument} - DOM that are parent of this iframe,
	 * @return {String} - string with iframe position
	 * @example [3,0,0]
	 */
b=function(e,t){var r,n;return n=[],r=function(e){var o,u,l;if(e.parentElement!==t.documentElement)return l=e.parentElement,u=Array.prototype.slice.call(l.children),o=u.indexOf(e),n.unshift(o),r(l)},r(e),JSON.stringify(n)},/*!
	 * delete iframe security policy
	 * @param {HTMLDocument} - DOM object
	 */
h=function(e){var t;return t=e.querySelectorAll("meta[http-equiv]"),t.forEach(function(e){var t,r;if(t=e.getAttribute("http-equiv"),L.call(n,t)>=0)return null!=(r=e.parentElement)?r.removeChild(e):void 0})},/*!
	 * delete iframe security policy
	 * @param {HTMLDocument} - DOM object
	 */
d=function(e){var t;return t=e.querySelectorAll("iframe[sendbox]"),t.forEach(function(e){return e.removeAttribute("sendbox")})},/*!
	 * add meta tag informing that this page is saved by PageCatch
	 * @param {HTMLDocument} - DOM of current document,
	 * @param {String} - string with url of current iframe,
	 * NOTE: if original-url meta alread exists (with original site url), do
	 * not create a new one. It means, that we resave already stored page
	 */
u=function(e,t){var r,n,o;if(!e.querySelector('meta[name="original-url"]'))return n=document.createElement("meta"),n.setAttribute("name","original-url"),n.setAttribute("content",t),r=null!=(o=e.getElementsByTagName("head")[0])?o:e.getElementsByTagName("body")[0],r.insertBefore(n,r.children[0])},/*!
	 * run functions for delete security policy
	 * @param {HTMLDocument} - DOM of current document
	 * @param {String} - string with url of current iframe
	 */
c=function(e,t){return h(e),d(e),u(e,t)},/*!
	 * take html attributes for save
	 * @param {array} array - array with attributes of tag <html>...</html>,
	 * @param {DocumentElement} status - Doctype of document,
	 * @return {String} - string with html code with all atributes + doctype
	 * @example "<! DOCTYPE html> <html lang="en" class="is-absent"><head>...</html>"
	 */
m=function(e,t){var r,n,o,u,l;for(l="<html ",n=o=0,u=e.length;o<u&&null!=e[n+1];n=o+=2)l+=e[n]+'="'+e[n+1]+'" ';return null!=t?(r=p(t),r+l+">"):l+=">"},/*!
	 * take doctype with attributes for save
	 * @param {array} array - array with attributes of doctype,
	 * @return {String} - string with doctype of page
	 * @example "<!DOCTYPE html>"
	 */
p=function(e){var t,r,n,o,u;for(u="<!DOCTYPE ",t="",r=n=0,o=e.length;0<=o?n<o:n>o;r=0<=o?++n:--n)if(e[r].trim())switch(r){case 0:u+=e[r]+" ";break;case 1:u+='PUBLIC "'+e[r]+'" ';break;case 2:u+='"'+e[r]+'"'}return u+">"},a=function(e){var t,r,n,o;for(r=e.querySelectorAll("div,img"),n=0,o=r.length;n<o;n++)t=r[n],t.parentElement.removeChild(t);return document},s=function(e){var t,r,n,o,u,l,i;for(i=[];e&&"HTML"!==e.nodeName;){if(u=e.parentElement)for(l=u.children,r=n=0,o=l.length;n<o;r=++n)if(t=l[r],u.children[r]===e){i.unshift(r);break}e=u}return i=i.join(":")},/*!
	 * save page
	 * @param {Number} tabID - number of tab which you want to save,
	 * @param {Function} cleanUp - function with clean any attributes from page,
	 * @param {Function} done - function in which will be return html text of
	 *                          saved page
	 * @example "<! DOCTYPE html> <html lang="en" class="is-absent"><head>...</html>"
	 */
v=function(e,t,r){var n,o,u,f,h;/*!
	   * parse tags as img,style,link and parse attribute style in any tags with him
	   * @param {Function} callback - function that check completing of save
	   */
/*!
	   * create one object from dictionary of frames
	   * @param {Object} obj - obj of dictionary(any frame from page)
	   * @param {String} str - string with current index in recursive
	   */
/*!
	   * finish and return string with complete all resourses in one HTML
	   * @param {Number} counter - counter of tags
	   * @param {Number} counter1 - counter of attributes
	   */
return o={},f=!1,h=function(e){var t,r,n,u,c,h,d,m,p,g,b,v,y,E,T,k,w,N,B,M,O,H,U,C,q,I,j,R,_,W,D,P,X,G,F,J,V,Y,$,K,z,Q;for(U=null!=(I=o[""])?I.document.querySelectorAll("[name]"):void 0,p=0,y=U.length;p<y;p++)if(H=U[p],"original-url"===H.getAttribute("name"))return f=!0,void e(0,0,0);for(c=[],M=null!=(j=o[""])?j.document.querySelectorAll("link"):void 0,m=!1,g=0,E=M.length;g<E;g++)B=M[g],P=B.getAttribute("rel"),P.indexOf("icon")!==-1&&("icon"===P&&(m=!0),c.push(B));m||(z=null!=(R=o[""])?R.url[0]:void 0,Q=z.split("/"),Q=Q.slice(0,3),z=Q.join("/")+"/favicon.ico",B=document.createElement("link"),B.setAttribute("rel","icon"),d=1,x(z,B,function(t,n,u){var l;return null!=t?(d--,console.error("(src)Base 64 error:",t.stack)):(""===u?(d++,0!==c.length?l=c[0].getAttribute("href"):d--,e(Y,r,d),x(l,n,function(t,n,u){return null!=t?(d--,console.error("(src)Base 64 error:",t.stack)):(n.setAttribute("href",u),o[""].document.head.appendChild(n),d--),e(Y,r,d)})):(n.setAttribute("href",u),o[""].document.head.appendChild(n),d--),e(Y,r,d))})),r=0,Y=0;for(b in o){for(u=o[b],u.document.head=a(u.document.head),console.log(u.document),J=u.document.querySelectorAll("style"),v=0,T=J.length;v<T;v++)if(F=J[v],0===F.innerHTML.length)for(X=s(F),_=u.styleSheets,O=0,k=_.length;O<k;O++)if(t=_[O],t[1]===X){F.innerHTML=t[0];break}for(K=u.document.querySelectorAll("*[style]"),C=0,w=K.length;C<w;C++)V=K[C],r++,S(V.getAttribute("style"),V,u.url[0],u,[],function(t,n,o,u){return r--,null!=t?console.error("Style attr error",t):n.setAttribute("style",u),e(Y,r,d)});for($=u.document.querySelectorAll("img,link,source,style"),q=0,N=$.length;q<N;q++)if(V=$[q],Y++,"LINK"!==V.nodeName)if("IMG"!==V.nodeName)if("STYLE"!==V.nodeName)if("SOURCE"!==V.nodeName);else{if(V.type.indexOf("video")>-1||V.type.indexOf("audio")>-1){Y--;continue}if(V.hasAttribute("srcset")&&!V.hasAttribute("src")){G=i(V.getAttribute("srcset"),u.url[0],u.url[1]),x(G,V,function(t,n,o){return Y--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("srcset",o),e(Y,r,d)});continue}if(V.hasAttribute("src")&&!V.hasAttribute("srcset")){G=i(V.getAttribute("src"),u.url[0],u.url[1]),x(G,V,function(t,n,o){return Y--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("src",o),e(Y,r,d)});continue}if(V.hasAttribute("src")&&V.hasAttribute("srcset")){V.setAttribute("srcset",""),G=i(V.getAttribute("src"),u.url[0],u.url[1]),x(G,V,function(t,n,o){return Y--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("src",o),e(Y,r,d)});continue}Y--}else S(V.innerHTML,V,u.url[0],u,[],function(t,n,o,u){return Y--,null!=t?(console.error("(style)inlineCSS error:",t.stack),console.error(n.innerHTML)):n.innerHTML=u,e(Y,r,d)});else{if(V.hasAttribute("srcset")&&!V.hasAttribute("src")){G=i(V.getAttribute("srcset"),u.url[0],u.url[1]),x(G,V,function(t,n,o){return Y--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("srcset",o),e(Y,r,d)});continue}if(V.hasAttribute("src")&&!V.hasAttribute("srcset")){G=i(V.getAttribute("src"),u.url[0],u.url[1]),x(G,V,function(t,n,o){return Y--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("src",o),e(Y,r,d)});continue}if(V.hasAttribute("src")&&V.hasAttribute("srcset")){V.setAttribute("srcset",""),G=i(V.getAttribute("src"),u.url[0],u.url[1]),x(G,V,function(t,n,o){return Y--,null!=t?console.error("(src)Base 64 error:",t.stack):n.setAttribute("src",o),e(Y,r,d)});continue}Y--}else{if("stylesheet"===(W=V.getAttribute("rel"))||"prefetch stylesheet"===W){h=i(V.getAttribute("href"),u.url[0],u.url[1]),n=V.attributes,S(A(h),V,h,u,n,function(t,n,o,u,l){var i,s,c,a;if(Y--,null!=t)console.error("style error",t);else{for(console.log("INLINECSSS_END",n),F=document.createElement("style"),F.innerHTML=u,c=0,s=l.length;c<s;c++)i=l[c],F.setAttribute(i.name,i.value);a=n.parentElement,a.insertBefore(F,n),a.removeChild(n)}return e(Y,r,d)});continue}if(D=V.getAttribute("rel"),L.call(l,D)>=0){V.parentElement.removeChild(V),Y--;continue}h=i(V.getAttribute("href"),u.url[0],u.url[1]),x(h,V,function(t,n,o){return Y--,null!=t?console.error("(href) xhrToBase64 error (href="+h+"):",t.stack):n.setAttribute("href",o),e(Y,r,d)})}}return f=!0,e(Y,r,d)},n=function(e,r){var u,l,i,s,a,f,h,d,p,g,v;for(s=e.document.getElementsByTagName("iframe"),p=[],f=0,d=s.length;f<d;f++){i=s[f],g=b(i,e.document),a=-1;for(h in e.framesIdx)g===h&&(a=e.framesIdx[h]);a!==-1&&(h=r+a,null!=o[h]?(n(o[h],h+":"),l=o[h].url,u=o[h].document,c(u,l),"function"==typeof t&&t(u,l),v=m(o[h].header,o[h].doctype)+u.documentElement.innerHTML+"</html>",p.push(i.setAttribute("srcdoc",v))):p.push(void 0))}return p},u=function(e,u,l){var i,s,a;if(console.log(e,u,f),0===e&&0===u&&0===l&&f===!0)return n(o[""],""),s=o[""].url,i=o[""].document,c(i,s),"function"==typeof t&&t(i,s),a=m(o[""].header,o[""].doctype)+i.documentElement.innerHTML+"</html>","function"==typeof r&&r(a),o={},f=!1},chrome.tabs.executeScript(e,{code:"("+y.toString()+")()",allFrames:!0,matchAboutBlank:!0},function(e){var t,r,n,l;for(r=0,n=e.length;r<n;r++)t=e[r],l={url:t[0],header:t[2],document:g(t[1],t[0]),framesIdx:t[4],doctype:t[5],actualUrls:t[6],styleSheets:t[7]},o[t[3]]=l;return h(u)})},e.exports=v},function(e,t){var r;r=function(e,t,r){var n,o;return console.log("BASE64URL",e),e.indexOf("data:")>=0||e.length<10?r(null,t,e):(o=new XMLHttpRequest,o.open("GET",e,!0),o.responseType="blob",n=new FileReader,o.onload=function(o){var u;return 200!==this.status?r(null,t," ",e):(u=this.response,n.onloadend=function(){return r(null,t,n.result,e)},n.readAsDataURL(u))},o.onerror=function(n){return console.error("XHR Error "+n.target.status+" occurred while receiving the document."),r(n,t," ",e)},o.send())},e.exports=r},function(e,t){var r=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};e.exports=function(e,t,n){var o,u,l,i,s,c;if(o=!1,('"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1])&&(e=e.substr(1,e.length-2)),e.startsWith("data:"))return e;if(e=e.replace(/\s/g,""),t=t.split("#")[0],e.startsWith("//"))return n+e;if(e.match(/^[\w\-_\d]+:/))return e;if("/"===e[0]&&"/"!==e[1])return o=!0,c=t.split("/"),c=c.slice(0,3),t=c.join("/"),t+e;for(c=t.split("/"),r.call(c[c.length-1],".")>=0&&!o&&c.pop(),""===c[c.length-1]&&c.pop(),i=e.split("/"),u=0,s=i.length;u<s;u++)if(l=i[u],".."===l)c.pop();else{if("."===l)continue;c.push(l)}return c.join("/")}},function(e,t){e.exports=function(e){var t,r;try{return r=new XMLHttpRequest,r.open("GET",e,!1),r.send(),200===r.status?r.responseText:" "}catch(e){return t=e,console.error("XHR",t.stack)," "}}},function(e,t,r){var n,o,u,l,i;u=r(2),o=r(1),i=r(3),l=function(e,t){var r,n,o,u;for(r=0,n=o=0,u=e.length;0<=u?o<u:o>u;n=0<=u?++o:--o)t[e[n]]&&r++;return r},n=function(e,t,r){var n,o,l,i;for(o=/@font-face\s*\{[\s\S]*?src\s*:\s*(?:url\(\s*(['"])?([\s\S]*?)\1\s*\))+[\s\S]*?.*?\}/g,l=/url\(\s*(['"])?([\s\S]*?)\1\s*\)/g;null!=(n=o.exec(e));)for(;null!=(i=l.exec(n[0]));)t[u(i[2],r)]=!0;return t},e.exports=function(e,t,r,s,c,a){var f,h,d,m,p,g,b,v,y,A,S,x;if(m=!1,e.indexOf("@import")>-1&&(y=/@import\s+(?:url\((['"])?([\s\S]*?)\1\)|(['"])?([\s\S]*?)\3)\s*[^;]*?(?:;|$)/gim,e=e.replace(y,function(e){var t;return t=y.exec(e),null!=t[2]?i(u(t[2],r)):null!=t[4]?i(u(t[4],r)):void 0})),e.indexOf("url(")<0)return a(null,t,s,e,c);for(x=[],d=[],f=[],b=0,S=/([\s\S]*?url\()\s*(['"]?)([\s\S]*?)\2\s*(\))/gim,v=S.exec(e);null!=v;){if(d.push(v[1],v[4]),x.push(u(v[3],r)),b=S.lastIndex,!(e.indexOf("url(",b+1)>-1)){d.push(e.slice(b)),b=e.length;break}v=S.exec(e)}for(d.push(e.slice(b)),s.actualUrls=n(e,s.actualUrls,r),console.log("MASIVE",x,s.actualUrls),h=l(x,s.actualUrls),p=g=0,A=x.length;0<=A?g<A:g>A;p=0<=A?++g:--g)s.actualUrls[x[p]]&&(m=!0,s.actualUrls[x[p]],console.log("COUNTER++",h),o(x[p],t,function(r,n,o,u){var l,i;if(h--,console.log(h),null!=r?console.error("Error base64:",r.stack):s.actualUrls[u]=o,0===h){for(console.log(s.actualUrls),e=[],l=0,i=0;l<d.length;)e.push(d[l]),l++,null!=x[i]&&(s.actualUrls[x[i]]||x[i].startsWith("data:")?x[i].startsWith("data:")?e.push('"'+x[i]+'"'):e.push('"'+s.actualUrls[x[i]]+'"'):e.push('""')),null!=d[l]&&e.push(d[l]),l++,i++;return a(null,t,s,e.join(""),c)}}));return m?void 0:a(null,t,s,d.join(""),c)}}])});
//# sourceMappingURL=page-catch.min.js.map