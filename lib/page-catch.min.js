!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["page-catch"]=t():e["page-catch"]=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var u=r[n]={exports:{},id:n,loaded:!1};return e[n].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n,u,o,l,i,s,c,a,f,h,d,m,p,g,b,v,y,A,x,S,E=function(e,t){function r(){this.constructor=e}for(var n in t)T.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},T={}.hasOwnProperty,k=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};S=r(1),i=r(2),A=r(3),x=r(4),l=["dns-prefetch","canonical","publisher","prefetch"," alternate","bb:rum"],n=["Content-Security-Policy","refresh"],u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return E(t,e),t}(Error),y=function(){var e,t,r,n,u,o,l,i,s,c;/*!
	   * get frame index in page
	   * @return {String} - frame index
	   * @example 0:3:5
	   */
/*!
	   * get frame position on content script
	   * @param {HTMLDocument} DOM - DOM document object
	   * @return {Object} - frames position on current frame
	   * @example [3,0,0]: 0
	   */
/*!
	   * get page doctype with all atributes'
	   * @param {DocumentType} doctype - document doctype object
	   * @return {array} - array with attributes of doctype page
	   * @return null - if doctype is absent
	   * @example ["html","w3c",""]
	   */
/*!
	   * get attributes of tag <html ...>...</html>
	   * @param {array} array - array with html attributes
	   * @return {array} - array with attributes of tag <html>
	   * @example ["lang","en","class","is-copy-enable"]
	   */
return i={},c=[],e=function(e){var t,r,n,u,o,l,i;for(i=[];e&&"HTML"!==e.nodeName;){if(o=e.parentElement)for(l=o.children,r=n=0,u=l.length;n<u;r=++n)if(t=l[r],o.children[r]===e){i.unshift(r);break}e=o}return i=i.join(":")},r=function(t){var r,n,u,o,l,i,s,a,f;for(i=[],r=0,u=t.length;r<u;r++)if(f=t[r],a="",f.rules){for(l=f.rules,n=0,o=l.length;n<o;n++)s=l[n],a+=s.cssText;i.push(c.push([a,e(f.ownerNode)]))}else i.push(void 0);return i},r(document.styleSheets),l=function(e){var t,r,n,u,o,l,s;for(l=[],n=0,o=e.length;n<o;n++)t=e[n],s=e[t].indexOf("url("),l.push(function(){var n;for(n=[];s>-1;)r=e[t].indexOf(")",s+1),u=e[t].substring(s+4,r),(u.startsWith('"')||u.startsWith("'"))&&(u=u.substring(1,u.length-1)),u.startsWith("#")||(i[u]=!0),n.push(s=e[t].indexOf("url(",r+1));return n}());return l},s=function(e){var t,r,n,u;for(r=e.children,n=0,u=r.length;n<u;n++)t=r[n],s(t);return l(window.getComputedStyle(e)),l(window.getComputedStyle(e,":after")),l(window.getComputedStyle(e,":before"))},s(document.body),o=function(){var e,t;/*!
	     * add frame-ID into fid[] array (recursive)
	     * @param {Window} win - parent's Window object
	     */
return t=[],e=function(r){var n,u,o,l,i,s,c;if(s=r.parent,r!==s){for(o="?",c=s.frames,u=l=0,i=c.length;l<i;u=++l)if(n=c[u],r===n){o=u;break}t.unshift(o),e(s)}},e(window),t.join(":")},u=function(e){var t,r,n,u,o,l,i,s;for(t={},/*!
	     * get frameID
	     * @param {HTMLIframeElement} obj - iframe document object
	     * @return {String} - string with index iframe
	     * @example [3,0,0]
	     */
n=function(t){var r,n;return n=[],r=function(t){var u,o,l;if(t.parentElement!==e)return l=t.parentElement,o=Array.prototype.slice.call(l.children),u=o.indexOf(t),n.unshift(u),r(l)},r(t),JSON.stringify(n)},r=e.getElementsByTagName("iframe"),l=0,i=r.length;l<i;l++)for(o=r[l],u=0;u<window.frames.length;){if(o.contentWindow===window.frames[u]){t[n(o,e)]=u,s=[];break}u++}return t},n=function(e){return null!=e?[e.name,e.publicId,e.systemId]:null},t=function(e){var t,r,n,u;for(u=[],r=0,n=e.length;r<n;r++)t=e[r],u.push(t.nodeName,t.nodeValue);return u},[[document.URL,document.location.protocol],document.documentElement.innerHTML,t(document.documentElement.attributes),o(),u(document.documentElement),n(document.doctype),i,c]},f=function(e){var t,r,n,u;for(t=e.querySelectorAll("iframe"),r=n=0,u=t.length;0<=u?n<u:n>u;r=0<=u?++n:--n)t[r].parentElement.removeChild(t[r]),r--;return e},/*!
	 * convert html text of every frame to DOM-Tree
	 * @param {string} htmlText - string with html code
	 * @return {HTMLDocument} - created DOM with string
	 */
g=function(e,t){var r,n,u,o,l,i,s,c,a,h,d,m,p,g,b;if(r=document.implementation.createHTMLDocument(),g=/(?:<!--[\s\S]*?-->|\s)*(<head[\s\S]*?>[\s\S]*?<\/head>)([\s\S]*)$/im,c=/<head(?:[\s\S]*?)>([\s\S]*?)<\/head>/,i=/<body(?:[\s\S]*?)>([\s\S]*?)<\/body>/,a=g.exec(e),s=a[1],l=a[2],b=document.createElement("html"),b.innerHTML=s+l,u=b.getElementsByTagName("body")[0].attributes,o=b.getElementsByTagName("head")[0].attributes,null!=a){for(r.head.innerHTML=c.exec(s)[1],r.head=f(r.head),r.body.innerHTML=i.exec(l)[1],h=0,m=u.length;h<m;h++)n=u[h],r.body.setAttribute(n.name,n.value);for(d=0,p=o.length;d<p;d++)n=o[d],r.head.setAttribute(n.name,n.value)}return r},/*!
	 * get frame position on background script
	 * @param {HTMLIframeElement} - iframe that we want find position,
	 * @param {HTMLDocument} - DOM that are parent of this iframe,
	 * @return {String} - string with iframe position
	 * @example [3,0,0]
	 */
b=function(e,t){var r,n;return n=[],r=function(e){var u,o,l;if(e.parentElement!==t.documentElement)return l=e.parentElement,o=Array.prototype.slice.call(l.children),u=o.indexOf(e),n.unshift(u),r(l)},r(e),JSON.stringify(n)},/*!
	 * delete iframe security policy
	 * @param {HTMLDocument} - DOM object
	 */
h=function(e){var t;return t=e.querySelectorAll("meta[http-equiv]"),t.forEach(function(e){var t,r;if(t=e.getAttribute("http-equiv"),k.call(n,t)>=0)return null!=(r=e.parentElement)?r.removeChild(e):void 0})},/*!
	 * delete iframe security policy
	 * @param {HTMLDocument} - DOM object
	 */
d=function(e){var t;return t=e.querySelectorAll("iframe[sendbox]"),t.forEach(function(e){return e.removeAttribute("sendbox")})},/*!
	 * add meta tag informing that this page is saved by PageCatch
	 * @param {HTMLDocument} - DOM of current document,
	 * @param {String} - string with url of current iframe,
	 * NOTE: if original-url meta alread exists (with original site url), do
	 * not create a new one. It means, that we resave already stored page
	 */
o=function(e,t){var r,n,u;if(!e.querySelector('meta[name="original-url"]'))return n=document.createElement("meta"),n.setAttribute("name","original-url"),n.setAttribute("content",t),r=null!=(u=e.getElementsByTagName("head")[0])?u:e.getElementsByTagName("body")[0],r.insertBefore(n,r.children[0])},/*!
	 * run functions for delete security policy
	 * @param {HTMLDocument} - DOM of current document
	 * @param {String} - string with url of current iframe
	 */
c=function(e,t){return h(e),d(e),o(e,t)},/*!
	 * take html attributes for save
	 * @param {array} array - array with attributes of tag <html>...</html>,
	 * @param {DocumentElement} status - Doctype of document,
	 * @return {String} - string with html code with all atributes + doctype
	 * @example "<! DOCTYPE html> <html lang="en" class="is-absent"><head>...</html>"
	 */
m=function(e,t){var r,n,u,o,l;for(l="<html ",n=u=0,o=e.length;u<o&&null!=e[n+1];n=u+=2)l+=e[n]+'="'+e[n+1]+'" ';return null!=t?(r=p(t),r+l+">"):l+=">"},/*!
	 * take doctype with attributes for save
	 * @param {array} array - array with attributes of doctype,
	 * @return {String} - string with doctype of page
	 * @example "<!DOCTYPE html>"
	 */
p=function(e){var t,r,n,u,o;for(o="<!DOCTYPE ",t="",r=n=0,u=e.length;0<=u?n<u:n>u;r=0<=u?++n:--n)if(e[r].trim())switch(r){case 0:o+=e[r]+" ";break;case 1:o+='PUBLIC "'+e[r]+'" ';break;case 2:o+='"'+e[r]+'"'}return o+">"},a=function(e){var t,r,n,u;for(r=e.querySelectorAll("div,img"),n=0,u=r.length;n<u;n++)t=r[n],t.parentElement.removeChild(t);return document},s=function(e){var t,r,n,u,o,l,i;for(i=[];e&&"HTML"!==e.nodeName;){if(o=e.parentElement)for(l=o.children,r=n=0,u=l.length;n<u;r=++n)if(t=l[r],o.children[r]===e){i.unshift(r);break}e=o}return i=i.join(":")},/*!
	 * save page
	 * @param {Number} tabID - number of tab which you want to save,
	 * @param {Function} cleanUp - function with clean any attributes from page,
	 * @param {Function} done - function in which will be return html text of
	 *                          saved page
	 * @example "<! DOCTYPE html> <html lang="en" class="is-absent"><head>...</html>"
	 */
v=function(e,t,r){var n,u,o,f,h;/*!
	   * parse tags as img,style,link and parse attribute style in any tags with him
	   * @param {Function} callback - function that check completing of save
	   */
/*!
	   * create one object from dictionary of frames
	   * @param {Object} obj - obj of dictionary(any frame from page)
	   * @param {String} str - string with current index in recursive
	   */
/*!
	   * finish and return string with complete all resourses in one HTML
	   * @param {Number} counter - counter of tags
	   * @param {Number} counter1 - counter of attributes
	   */
return u={},f=!1,h=function(e){var t,n,o,c,h,d,m,p,g,b,v,y,E,T,w,L,B,N,O,H,C,M,q,U,j,I,_,R,W,D,P,X,G,J,F,Y,$,K,V,z,Q,Z;for(q=null!=(I=u[""])?I.document.querySelectorAll("[name]"):void 0,g=0,E=q.length;g<E;g++)if(M=q[g],"original-url"===M.getAttribute("name"))return void r(u[""].text);for(h=[],H=null!=(_=u[""])?_.document.querySelectorAll("link"):void 0,p=!1,m=0,b=0,T=H.length;b<T;b++)O=H[b],X=O.getAttribute("rel"),null!==X&&X.indexOf("icon")!==-1&&("icon"===X&&(p=!0),h.push(O));p||(Q=null!=(R=u[""])?R.url[0]:void 0,Z=Q.split("/"),Z=Z.slice(0,3),Q=Z.join("/")+"/favicon.ico",O=document.createElement("link"),O.setAttribute("rel","icon"),m=1,S(Q,O,function(t,r,o){var l;return null!=t?(m--,console.error("(src)Base 64 error:",t.stack)):(""===o?(m++,0!==h.length?l=h[0].getAttribute("href"):m--,e(K,n,m),S(l,r,function(t,r,o){return null!=t?(m--,console.error("(src)Base 64 error:",t.stack)):(r.setAttribute("href",o),u[""].document.head.appendChild(r),m--),e(K,n,m)})):(r.setAttribute("href",o),u[""].document.head.appendChild(r),m--),e(K,n,m))})),n=0,K=0;for(v in u){for(c=u[v],c.document.head=a(c.document.head),Y=c.document.querySelectorAll("style"),y=0,w=Y.length;y<w;y++)if(F=Y[y],0===F.innerHTML.length)for(G=s(F),W=c.styleSheets,C=0,L=W.length;C<L;C++)if(t=W[C],t[1]===G){F.innerHTML=t[0];break}for(z=c.document.querySelectorAll("*[style]"),U=0,B=z.length;U<B;U++)$=z[U],n++,x($.getAttribute("style"),$,c.url[0],c,[],function(t,r,u,o){return n--,null!=t?console.error("Style attr error",t):r.setAttribute("style",o),e(K,n,m)});for(V=c.document.querySelectorAll("img,link,source,style, object"),j=0,N=V.length;j<N;j++)if($=V[j],K++,"LINK"!==$.nodeName)if("IMG"!==$.nodeName)if("OBJECT"!==$.nodeName)if("STYLE"!==$.nodeName)if("SOURCE"!==$.nodeName)K--;else{if($.type.indexOf("video")>-1||$.type.indexOf("audio")>-1){K--;continue}if($.hasAttribute("srcset")&&!$.hasAttribute("src")){J=i($.getAttribute("srcset"),c.url[0],c.url[1]),S(J,$,function(t,r,u){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):r.setAttribute("srcset",u),e(K,n,m)});continue}if($.hasAttribute("src")&&!$.hasAttribute("srcset")){J=i($.getAttribute("src"),c.url[0],c.url[1]),S(J,$,function(t,r,u){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):r.setAttribute("src",u),e(K,n,m)});continue}if($.hasAttribute("src")&&$.hasAttribute("srcset")){$.setAttribute("srcset",""),J=i($.getAttribute("src"),c.url[0],c.url[1]),S(J,$,function(t,r,u){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):r.setAttribute("src",u),e(K,n,m)});continue}K--}else x($.innerHTML,$,c.url[0],c,[],function(t,r,u,o){return K--,null!=t?console.error("(style)inlineCSS error:",t.stack):r.innerHTML=o,e(K,n,m)});else{if($.hasAttribute("data")){J=i($.getAttribute("data"),c.url[0],c.url[1]),S(J,$,function(t,r,u){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):r.setAttribute("srcset",u),e(K,n,m)});continue}K--}else{if($.hasAttribute("srcset")&&!$.hasAttribute("src")){J=i($.getAttribute("srcset"),c.url[0],c.url[1]),S(J,$,function(t,r,u){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):r.setAttribute("srcset",u),e(K,n,m)});continue}if($.hasAttribute("src")&&!$.hasAttribute("srcset")){J=i($.getAttribute("src"),c.url[0],c.url[1]),S(J,$,function(t,r,u){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):r.setAttribute("src",u),e(K,n,m)});continue}if($.hasAttribute("src")&&$.hasAttribute("srcset")){$.setAttribute("srcset",""),J=i($.getAttribute("src"),c.url[0],c.url[1]),S(J,$,function(t,r,u){return K--,null!=t?console.error("(src)Base 64 error:",t.stack):r.setAttribute("src",u),e(K,n,m)});continue}K--}else{if("stylesheet"===(D=$.getAttribute("rel"))||"prefetch stylesheet"===D){d=i($.getAttribute("href"),c.url[0],c.url[1]),o=$.attributes,x(A(d),$,d,c,o,function(t,r,u,o,l){var i,s,c,a;if(K--,null!=t)console.error("style error",t);else{for(console.log("INLINECSSS_END",r),F=document.createElement("style"),F.innerHTML=o,c=0,s=l.length;c<s;c++)i=l[c],F.setAttribute(i.name,i.value);a=r.parentElement,a.insertBefore(F,r),a.removeChild(r)}return e(K,n,m)});continue}if(P=$.getAttribute("rel"),k.call(l,P)>=0){$.parentElement.removeChild($),K--;continue}d=i($.getAttribute("href"),c.url[0],c.url[1]),S(d,$,function(t,r,u){return K--,null!=t?console.error("(href) xhrToBase64 error (href="+d+"):",t.stack):r.setAttribute("href",u),e(K,n,m)})}}return f=!0,e(K,n,m)},n=function(e,r){var o,l,i,s,a,f,h,d,p,g,v;for(s=e.document.getElementsByTagName("iframe"),p=[],f=0,d=s.length;f<d;f++){i=s[f],g=b(i,e.document),a=-1;for(h in e.framesIdx)g===h&&(a=e.framesIdx[h]);a!==-1&&(h=r+a,null!=u[h]?(n(u[h],h+":"),l=u[h].url,o=u[h].document,c(o,l),"function"==typeof t&&t(o,l),v=m(u[h].header,u[h].doctype)+o.documentElement.innerHTML+"</html>",p.push(i.setAttribute("srcdoc",v))):p.push(void 0))}return p},o=function(e,o,l){var i,s,a;if(console.log(e,o,l,f),0===e&&0===o&&0===l&&f===!0)return n(u[""],""),s=u[""].url,i=u[""].document,c(i,s),"function"==typeof t&&t(i,s),a=m(u[""].header,u[""].doctype)+i.documentElement.innerHTML+"</html>","function"==typeof r&&r(a),u={},f=!1},chrome.tabs.executeScript(e,{code:"("+y.toString()+")()",allFrames:!0,matchAboutBlank:!0},function(e){var t,r,n,l;for(r=0,n=e.length;r<n;r++)t=e[r],l={url:t[0],header:t[2],document:g(t[1],t[0]),framesIdx:t[4],doctype:t[5],actualUrls:t[6],styleSheets:t[7],text:t[1]},u[t[3]]=l;return h(o)})},e.exports=v},function(e,t){var r;r=function(e,t,r){var n,u;return e.indexOf("data:")>=0||e.length<10?r(null,t,e):(u=new XMLHttpRequest,u.open("GET",e,!0),u.responseType="blob",n=new FileReader,u.onload=function(u){var o;return 200!==this.status?r(null,t," ",e):(o=this.response,n.onloadend=function(){return r(null,t,n.result,e)},n.readAsDataURL(o))},u.onerror=function(n){return console.error("XHR Error "+n.target.status+" occurred while receiving the document."),r(n,t," ",e)},u.send())},e.exports=r},function(e,t){var r=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};e.exports=function(e,t,n){var u,o,l,i,s,c;if(u=!1,('"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1])&&(e=e.substr(1,e.length-2)),e.startsWith("data:"))return e;if(e=e.replace(/\s/g,""),t=t.split("#")[0],e.startsWith("//"))return n+e;if(e.match(/^[\w\-_\d]+:/))return e;if("/"===e[0]&&"/"!==e[1])return u=!0,c=t.split("/"),c=c.slice(0,3),t=c.join("/"),t+e;for(c=t.split("/"),r.call(c[c.length-1],".")>=0&&!u&&c.pop(),""===c[c.length-1]&&c.pop(),i=e.split("/"),o=0,s=i.length;o<s;o++)if(l=i[o],".."===l)c.pop();else{if("."===l)continue;c.push(l)}return c.join("/")}},function(e,t){e.exports=function(e){var t,r;try{return r=new XMLHttpRequest,r.open("GET",e,!1),r.send(),200===r.status?r.responseText:" "}catch(e){return t=e,console.error("XHR",t.stack)," "}}},function(e,t,r){var n,u,o,l,i;o=r(2),u=r(1),i=r(3),l=function(e,t){var r,n,u,o;for(r=0,n=u=0,o=e.length;0<=o?u<o:u>o;n=0<=o?++u:--u)t[e[n]]&&r++;return r},n=function(e,t,r){var n,u,l,i;for(u=/@font-face\s*\{[\s\S]*?src\s*:\s*(?:url\(\s*(['"])?([\s\S]*?)\1\s*\))+[\s\S]*?.*?\}/g,l=/url\(\s*(['"])?([\s\S]*?)\1\s*\)/g;null!=(n=u.exec(e));)for(;null!=(i=l.exec(n[0]));)t[o(i[2],r)]=!0;return t},e.exports=function(e,t,r,s,c,a){var f,h,d,m,p,g,b,v,y,A,x,S;if(m=!1,e.indexOf("@import")>-1&&(y=/@import\s+(?:url\((['"])?([\s\S]*?)\1\)|(['"])?([\s\S]*?)\3)\s*[^;]*?(?:;|$)/gim,e=e.replace(y,function(e){var t;return t=y.exec(e),null==t?"":null!=t[2]?i(o(t[2],r)):null!=t[4]?i(o(t[4],r)):void 0})),e.indexOf("url(")<0)return a(null,t,s,e,c);for(S=[],d=[],f=[],b=0,x=/([\s\S]*?url\()\s*(['"]?)([\s\S]*?)\2\s*(\))/gim,v=x.exec(e);null!=v;){if(d.push(v[1],v[4]),S.push(o(v[3],r)),b=x.lastIndex,!(e.indexOf("url(",b+1)>-1)){d.push(e.slice(b)),b=e.length;break}v=x.exec(e)}for(d.push(e.slice(b)),s.actualUrls=n(e,s.actualUrls,r),h=l(S,s.actualUrls),p=g=0,A=S.length;0<=A?g<A:g>A;p=0<=A?++g:--g)s.actualUrls[S[p]]&&(m=!0,s.actualUrls[S[p]],u(S[p],t,function(r,n,u,o){var l,i;if(h--,null!=r?console.error("Error base64:",r.stack):s.actualUrls[o]=u,0===h){for(e=[],l=0,i=0;l<d.length;)e.push(d[l]),l++,null!=S[i]&&(s.actualUrls[S[i]]||S[i].startsWith("data:")?S[i].startsWith("data:")?e.push('"'+S[i]+'"'):e.push('"'+s.actualUrls[S[i]]+'"'):e.push('""')),null!=d[l]&&e.push(d[l]),l++,i++;return a(null,t,s,e.join(""),c)}}));return m?void 0:a(null,t,s,d.join(""),c)}}])});
//# sourceMappingURL=page-catch.min.js.map